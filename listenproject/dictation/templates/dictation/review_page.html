<h1>ğŸ¤ å£è¿°éªŒæ”¶é¡µé¢</h1>

<form method="post">
    {% csrf_token %}
    <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>ç”¨æˆ·å½•éŸ³</th>
                <th>è¯†åˆ«æ–‡æœ¬</th>          <!-- æ–°å¢ -->
                <th>é¢˜ç›®å†…å®¹</th>
                <th>ç³»ç»Ÿåˆ¤å®š</th>          <!-- æ–°å¢ -->
                <th>æœ€ç»ˆç»“æœ</th>          <!-- ä¿ç•™äººå·¥æ‰“åˆ† -->
            </tr>
        </thead>
        <tbody id="review-body"></tbody>
    </table>

    <button type="submit">æäº¤è¯„åˆ†</button>
</form>

<script>
    /* æœ¬åœ°å­˜çš„æ˜¯ practice_recordingsï¼ˆå£è¿°ï¼‰ */
    const recs = JSON.parse(localStorage.getItem('practice_recordings') || '[]');
    
    async function fetchMaterial(mid){
      const res = await fetch(`/api/material/${mid}/`);
      return await res.json();
    }
    
    async function buildReviewTable(){
      const tbody = document.getElementById('review-body');
    
      for(const r of recs){
        const m   = await fetchMaterial(r.material_id);
        const row = document.createElement('tr');
    
        /* â‘  ç”¨æˆ·å½•éŸ³æ’­æ”¾ */
        const audioTd = document.createElement('td');
        audioTd.innerHTML = r.audio_data
           ? `<audio controls src="${r.audio_data}"></audio>`
           : 'ï¼ˆæ— ï¼‰';
        row.appendChild(audioTd);
    
        /* â‘¡ è¯†åˆ«æ–‡æœ¬ï¼ˆå‰ç«¯è¯†åˆ«ç»“æœï¼‰ */
        const textTd  = document.createElement('td');
        textTd.textContent = r.recognized_text || 'ï¼ˆæœªè¯†åˆ«ï¼‰';
        /* ä¹ŸæŠŠè¯†åˆ«æ–‡æœ¬ä½œä¸ºéšè—åŸŸæäº¤ï¼Œæ–¹ä¾¿åç«¯ä¿å­˜ */
        textTd.innerHTML += `<input type="hidden" name="input_${m.id}" value="${r.recognized_text || ''}">`;
        row.appendChild(textTd);
    
        /* â‘¢ é¢˜ç›®å†…å®¹ */
        const qTd = document.createElement('td');
        qTd.textContent = m.question_text || m.content;
        row.appendChild(qTd);
    
        /* â‘£ ç³»ç»Ÿè‡ªåŠ¨åˆ¤åˆ†ï¼ˆtrue / false / nullï¼‰ */
        const sysTd = document.createElement('td');
        const auto = r.auto_judge;
        sysTd.textContent = (auto===true) ? 'âœ… æ­£ç¡®' :
                            (auto===false)? 'âŒ é”™è¯¯' : 'â€”';
        row.appendChild(sysTd);
    
        /* â‘¤ ç”¨æˆ·æœ€ç»ˆæ‰“åˆ† */
        const markTd = document.createElement('td');
        markTd.innerHTML = `
           <label><input type="radio" name="result_${m.id}" value="correct">âœ”</label>
           <label><input type="radio" name="result_${m.id}" value="wrong">âœ˜</label>`;
        row.appendChild(markTd);
    
        tbody.appendChild(row);
      }
    }
    buildReviewTable();
    </script>